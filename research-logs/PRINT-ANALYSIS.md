# Print Log Analysis Decisions and Formatting Guide

This document records the analysis approach and formatting rules used for `devmode-print*.txt` so the same style can be reproduced later.

## Scope and inputs

- Logs are generated by `devmode.py` and plugins (e.g., `plugin-logger.py` or `plugin-example.py`).
- The goal is a timeline-style analysis that **retains exact log lines** with their timestamps.
- Source files: `devmode-print*.txt`.
- Output files: `devmode-print*.md` (one markdown per log).

## Core decisions

- **Always preserve the exact log lines** when citing events, including timestamps, prefixes, and ANSI color codes if present.
- **Use monotonic timestamps from the log**; do not reinterpret or convert to wall clock time.
- **Focus on state transitions and system behavior**, not raw telemetry spam.
- **Explicitly call out `/home` command sequences** (CMD pending ‚Üí hooks armed ‚Üí breakpoint hit ‚Üí injections/retvals).
- **Highlight print lifecycle**: attach/init, config, state machine transitions, exposure settings, layer progress, STOPPING/FINISH, post-print hooks.
- **Note errors or their absence**: if no error strings found, say so.

## Event selection rules

Choose a small, representative set of lines that tell the story:

1. **Attach + config**
   - `using pid ...`, `loaded ... entries`, plugin load, `mem_reader=...`.
   - OTA breakpoint arming lines, if present.

2. **Telemetry coming online**
   - First vat temperature update and the transition to `tank_temp_online: 1`.
   - SDCP metadata resolution (one consolidated line with resolution info).

3. **Printing enablement**
   - `printing_level_mode` and `printing_sync_mode` lines.

4. **Printer state transitions**
   - Use `printer_state` changes as anchors.
   - Reference the state mapping in `PROJECT.md`:
     - 1=IDLE, 2=HOME, 3=CALIBRATE, 4=PROBE, 5=LEVEL, 6=HEAT, 7=CHECK, 8=WAIT, 9=FINISH, 10/11/12=STAGE1/2/3, 14=STOPPING.
   - Include only the **first line** where a new state appears.

5. **Exposure + UV settings**
   - Base layers: long `printer_exposure_time_ms` (e.g., 25000.0) with UV PWM (e.g., 204.0).
   - Normal layers: shorter `printer_exposure_time_ms` (e.g., 2300.0) with UV PWM (e.g., 255.0).
   - Use the first line where each regime appears.

6. **Layer progression**
   - First layer increment (`printer_current_layer` or `print_info_current_layer` changes).
   - Mid-print representative line (optional).
   - Final layer increment to `print_info_total_layer`.

7. **STOPPING / FINISH**
   - First line where state `14` appears.
   - First line where state `9` appears.

8. **/home command injections**
   - Always include this block if present:
     - `CMD pending: home`
     - `INSTALL ...` + `armed cmd_hook_*` lines (printer/UI/temp)
     - `CMD waiting for breakpoint: home`
     - `BREAKPOINT_ADDR=...` + `HIT_CONFIRMED`
     - `CMD home axis=0`
     - `CMD injecting ...` + `CMD inject call ... retval=...`
     - Optional `REGS ...` snapshot lines.
   - Preserve ANSI color codes in these lines.

9. **Temperature tail**
   - Final vat temperature line near the end of the log.

## Error and anomaly scan

- Search for `ERROR`, `error`, `ERR`, `fail`, `WARN`, `panic`, `exception`.
- If no matches, explicitly state ‚ÄúNo error strings appear in the log.‚Äù
- Do not infer errors from normal state transitions or hook activity.

## Formatting rules (Markdown output)

### Structure

- Title: `# Devmode Print N Timeline Analysis`
- Short intro line: ‚ÄúThis analysis uses the monotonic timestamps from the log and keeps the exact log lines for each cited event.‚Äù
- Sections:
  - `## Timeline (key events)`
  - `## Observations and learnings`
  - `## Potential follow-ups`

### Timeline entries

Each entry:

- A short bullet line describing the event.
- A fenced code block with **exact** log lines.

Example:

```
- Tracer attaches, loads config, and arms OTA breakpoints.
```
```
<timestamp> using pid ...
<timestamp> loaded ...
<timestamp> armed ota_get_info_AIC...
```

### Line handling

- **Do not edit or rewrap log lines**.
- Keep ANSI color codes exactly as logged (e.g., `[33m`).
- If multiple related lines exist, include only the minimum needed to show progression.

### Observations

Keep them concise, grounded in cited lines:

- Log span length (compute `last_ts - first_ts`).
- State machine progression.
- Exposure/PWM regime shift.
- Heat stage behavior (if visible).
- Any hook/breakpoint behavior.
- Temperature stability.

### Potential follow-ups

Only include if there are natural next questions:

- Unexpected `/home` timing.
- Exposure ramp changes that should be confirmed against profile settings.
- Hook arming placement (if it fires later/earlier than expected).

## Practical extraction tips

- Use `rg -n` for string searches; avoid full-log dumps when possible.
- To find state transitions, scan `printer_state` and capture the first line where each state appears.
- For exposure shifts, search `printer_exposure_time_ms` for base-layer and normal-layer values.
- For `/home`, search `CMD pending: home` and include the surrounding block.
- Prefer exact timestamps over inferred order if logs are dense.

## Consistency with prior analyses

- `devmode-print3.md` and `devmode-print2.md` follow this format.
- `devmode-print1.md` uses ‚ÄúAnalysis:‚Äù per line; retain that style if editing it instead of rewriting.
